<html>

	<head>
		<meta charset="utf-8" />
		<title>电子处方</title>
		
		<link rel="stylesheet" href="/static/plugs/bootstrap-3.3.7/css/bootstrap.min.css" />
		<link rel="stylesheet" href="/static/plugs/bigautocomplete/css/jquery.bigautocomplete.css" type="text/css" />

		<script type="text/javascript" src="/static/plugs/jquery-2.1.1/jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="/static/plugs/bootstrap-3.3.7/js/bootstrap.min.js"></script>
		<script src="/static/plugs/bigautocomplete/js/jquery.bigautocomplete.js"></script>
		

	</head>

	<body>
		<div class="container">
			<div class="row clearfix">
				<div class="col-md-12 column">
					<nav class="navbar navbar-default navbar-inverse navbar-fixed-top" role="navigation">
						<div class="navbar-header">
							<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
							<a class="navbar-brand" href="#">电子处方</a>
						</div>

						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
							<ul class="nav navbar-nav">
								<li class="active">
									<a href="#">温岭市第一人民医院</a>
								</li>
							</ul>
							<form class="navbar-form navbar-right" role="search">
								<div class="form-group">
									<input type="text" class="form-control" />
								</div> <button type="submit" class="btn btn-default">查询</button>
							</form>
							
						</div>

					</nav>
					<div class="row clearfix" style="margin-top: 60px;">
						<div class="col-md-12 column">
							<h3>
								处方登记
							</h3>
						</div>
					</div>
					<hr />
					<div class="row clearfix" >
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">门诊号码</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">医院名称</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">科室名称</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">就诊日期</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>

					</div>

					<div class="row clearfix" style="margin-top: 5px;">
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">病人姓名</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">病人性别</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">病人年龄</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">病人地址</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>
					</div>

					<div class="row clearfix" style="margin-top: 5px;">
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">医生工号</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">医生姓名</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">症&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;状</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>
						<div class="col-md-3 column">
							<div class="input-group">
								<span class="input-group-addon">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注</span>
								<input type="text" class="form-control" placeholder="twitterhandle">
							</div>
						</div>
					</div>

					<hr style="margin-top: 8px;" />
					<div class="row clearfix" style="margin-top: -12px;">
						<div class="col-md-10 column">
						</div>
						<div class="col-md-1 column">
							<button class="btn btn-default btn-success " type="button"><em class="glyphicon glyphicon-floppy-save"></em> 保存</button>
						</div>
						<div class="col-md-1 column">
							<button class="btn btn-default btn-primary " type="button"><em class="glyphicon glyphicon-search"></em> 查询</button>
						</div>
					</div>
					<hr style="margin-top: 8px;" />

				</div>
			</div>
			<div class="row clearfix">
				<div class="col-md-12 column">

					<table class="table table-condensed" style="font-size: 14px;">
						<thead>
							<tr>
								<th>
									序号
								</th>
								<th style="display: none;">
									商品ID
								</th>
								<th>
									商品编码
								</th>
								<th>
									名称/通用名
								</th>
								<th>
									规格
								</th>
								<th>
									每次剂量
								</th>
								<th>
									单位
								</th>
								<th>
									频次
								</th>
								<th>
									总量
								</th>
								<th>
									用法
								</th>
								<th>
									单价
								</th>
								<th>
									删除
								</th>
							</tr>
						</thead>
						<tbody id="cflist">
							<tr>
								<td>
									<span id="numno" style="line-height: 20px;">1</span>
								</td>
								<td style="display: none;">
									<span id="iproductid"></span>
								</td>
								<td>
									<span id="vcproductcode"></span>
								</td>
								<td>
									<input type="text" id="universalname" class="textvcuniversalname" autocomplete="off" style="width: 98%;" />
								</td>
								<td>
									<span id="vcstandard"></span>
								</td>
								<td>
									<input type="text" id="dosis" autocomplete="off" style="width: 60px;"  />
								</td>
								<td>
									<span >克</span>
								</td>
								<td>
									<input type="text" id="frequency" autocomplete="off" style="width: 80px;" />
								</td>
								<td>
									<input type="text" id="totalcounts" autocomplete="off" style="width: 80px;"  />
								</td>
								<td>
									<span >1</span>
								</td>
								<td>
									<span >￥10</span>
								</td>
								<td>
									<button class="btn btn-danger btn-sm" id="btn-del"><em class="glyphicon glyphicon-remove"></em>删除</button>
								</td>
							</tr>
						
						</tbody>
						<tbody>
							<tr>
								<td colspan="11"><button class="btn btn-sm btn-block " onclick="createrow()">+</button></td>
							</tr>
						</tbody>
						
					</table>
				</div>
			</div>
			<!--<hr style="margin-top: 82px;"/>
			<div class="row clearfix" style="margin-top: -32px;">
				<div class="col-md-12 column">
					
					<p class="text-center h3">Copyright ©2018 恩泽医药有限公司</p>
					<p class="text-center">浙江省.临海市.古城街道回浦路92号</p>
					
					
				</div>
			</div>-->
			
		</div>

		<script type="text/javascript">
			

			$(function() {

				//设置下拉选择框
				initselect();

				//设置焦点
				$('#cflist input:first').focus();

				//初始化按键
				initkey();

				//初始化明细删除键
				initdel();

			});

			//初始化商品信息输入框
			function initselect() {
				$names = $(".textvcuniversalname");
				$.each($names, function(i, c) {
					//$(this).val($(this).val().toUpperCase());
					$(this).bigAutocomplete({
						width: 543,
						url: 'http://localhost:85/ezapi/public/index.php/Data/customertest',
						callback: function(data) {
							//alert(data.goodstype); 
							//获取所有的input
							//var trinputlen=$("#cflist tr:first input").length
							//var nexIdx=trinputlen*(i+1)+1;
							//$("#cflist input")[nexIdx].focus();
							//var h=$(c).parent().html();
							//alert(h);
							$(c).parent().parent().find("#vcstandard").html(data.goodstype);
							$(c).parent().parent().find("#vcproductcode").html(data.goodsno);

							var precount = $("#cflist tr:first input").length;
							var nexIdx = precount * i + 1;
							$("#cflist input")[nexIdx].focus();

						}
					});

				});
			}

			function initkey() {
				var $inp = $("#cflist input");
				var length = $inp.length;
				$.each($inp, function(i, c) {
					$(this).bind('keydown', function(e) {
						var key = e.which;
						//alert(key);
						if((key == 13 && "universalname" != $(this).attr("id")) || key == 39) { //向右或者回车
							e.preventDefault();
							if(i + 1 != length) {
								var nxtIdx = i + 1;
								$("#cflist input")[nxtIdx].focus();
							}
						}
						if(key == 37) { //向左
							e.preventDefault();
							if(i != 0) {
								var preIdx = i - 1;
								$("#cflist input")[preIdx].focus();
							}
						}
						if((key == 40 || key == 13) && $(this).attr("id") == "totalcounts") { //向下
							e.preventDefault();
							createrow();
							
						}

					})
				});
			}

			function initdel() {
				//$('#btn-del').unbind();
				/*$('#btn-del').on('click', function() {
					alert("x");
				   // $(this).parent().parent().remove();
				});*/

				$("#cflist #btn-del").click(function() {
					$(this).parent().parent().remove();
				})

			}
			//新加一行
			function createrow() {
				//var rownum=$("#cflist tr").length+1;
				var numno=$("#cflist tr:last").length;
				var rownum=numno==0?1:Number($("#cflist tr:last").find('#numno').html()) + 1;
				//var rownum = Number($("#cflist tr:last").find('#numno').html()) + 1;
				var row = '<tr>' +
					'<td>' +
					'<span id="numno">' + rownum + '</span>' +
					'</td>' +
					'<td style="display: none;">' +
					'<span id="iproductid"></span>' +
					'</td>' +
					'<td>' +
					'<span id="vcproductcode"></span>' +
					'</td>' +
					'<td>' +
					'<input type="text" id="universalname"  class="textvcuniversalname " autocomplete="off" style="width: 98%;" />' +
					'</td>' +
					'<td>' +
					'<span id="vcstandard"></span>' +
					'</td>' +
					'<td>' +
					'<input type="text" id="dosis"  autocomplete="off" style="width: 60px;"  />' +
					'</td>' +
					'<td>' +
					'<span>克</span>' +
					'</td>' +
					'<td>' +
					'<input type="text" id="frequency" autocomplete="off" style="width: 80px;"  />' +
					'</td>' +
					'<td>' +
					'<input type="number" id="totalcounts"  autocomplete="off" style="width: 80px;"  />' +
					'</td>' +
					'<td>' +
					'<span>1</span>' +
					'</td>' +
					'<td>' +
					'<span>￥10</span>' +
					'</td>' +
					'<td>' +
					'<button class="btn btn-danger btn-sm" id="btn-del"><em class="glyphicon glyphicon-remove"></em>删除</button>' +
					'</td>' +
					'</tr>';

				$("#cflist").append(row);

				initdel();
				initselect();
				//设置新行的首个输入框聚焦
				$("#cflist tr:last").find("input:first").focus();
				initkey();
				
			}
		</script>

	</body>

</html>